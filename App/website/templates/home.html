{% extends "base.html" %} {% block title %}Home{% endblock %}
{% block content %}

<script type="text/javascript"
src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>

<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.5.js" type="text/javascript"></script>
<!--Sign up form-->
<!--When this form is submitted, send a post request to the backend-->

<h1 class="intro-message"><span id="time"></span> {{user.first_name}}!</h1> 
<h4 class ="fact" style="text-align:center;font-size:30px;color:grey;border-radius: 50%;"> <span id="fact"></span></h4>
<br></br>
<div class="current-stats"> 
    <h1 class="header">Currently.</h1> 
    <div class="stats-grid">
        <div class="stat">
            <h1 class="stat-header">Temperature
                <span id="tep"></span>
            </h1>
            <h4 id="temp" class="current-stat">{{currTemp}} °C</h4>
            <meta name="viewport" content="width=device-width, initial-scale=1">
                <style>
                    .dot {
                    height: 25px;
                    width: 25px;
                    background-color: #bbb;
                    border-radius: 50%;
                    display: inline-block;
                    style="color:blue;"
                    }
                </style>
            <div style="text-align:center">
                <i id='dot' class="fa fa-circle" style="font-size:30px;color:red"></i>
            </div>
        </div>
        <div class="stat">
            <h1 class="stat-header">Volume
                <span id="tep"></span>
            </h1>
            <h4 id="vol" class="current-stat">{{currVolume}} ml</h4>
        </div>
    </div>
</div>

<form method ="POST" style="padding-top:100px">
    <h1 align="center" class="header">Update Preferences.</h1>
    <div class="form-group">
        <div class="temp-grid">
            <div class="temp-range">
                <label for="select-temperature">Set Temperature</label>
                <input 
                    type="number" 
                    class="form-control"
                    id="select-temperature" 
                    name="select-temperature"
                    placeholder="Select temperature"
                    value="60"
                />
            </div>
            <div class="temp-range">
                <label for="select-range">Set Range</label>
                <input 
                    type="number" 
                    class="form-control"
                    id="select-range" 
                    name="select-range"
                    value="3"
                />
            </div>
        </div>
    </div>
    <div class="form-group">
        <div class="LED-grid">
            <div class="LED">
                <label for="led-color">Set <span style="color:dodgerblue">Cold</span> LED</label>
                <input 
                    type="color" 
                    class="form-control LED-picker"
                    name="C_RGB"
                    placeholder="Enter LED color in RGB format"
                    id="C_RGB"
                    value = {{cold}}
                />
            </div>
            <div class="LED">
                <label for="led-color">Set <span style="color:#07ad07">Perfect</span> LED</label>
                <input 
                    type="color" 
                    class="form-control LED-picker"
                    name="P_RGB"
                    placeholder="Enter LED color in RGB format"
                    id="P_RGB"
                />
            </div>
            <div class="LED">
                <label for="led-color">Set <span style="color:red">High</span> LED</label>
                <input 
                    type="color" 
                    class="form-control LED-picker"
                    name="H_RGB"
                    placeholder="Enter LED color in RGB format"
                    id="H_RGB"
                />
            </div>
        </div>
    </div>
    <!--
    <ul class = "list-group list-group-flush" id="settings">
        {% for setting in user.settings%}
        <li class = "list-group-item">{{setting.temperature, setting.ledcolor}}</li>
        {% endfor %}
    </ul>
    -->
    <div style="width:100%;margin:auto;text-align: center;">
        <button type ="submit" class = "btn btn-primary">Confirm</button>    
    </div>

    

<!--
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script type="text/javascript">
$(document).ready(function(){
  setInterval(fetch, 5000);
});
function fetch() {
    //var $temp = $('#currTemp')
    console.log('here')
    alert("here")
    $.ajax({
        url: 'http://184.148.145.47:5000/users',
        type: "GET",
        dataType: "json",
        data:JSON.stringify({}),
        //headers: {
        //'Content-Type': 'application/x-www-form-urlencoded'
        //},
        crossDomain: true,
        success: function(data) {
            //$('#temp').append("<li>" + JSON.stringify(data) + "<li>")
            //document.getELementById('current') = JSON.stringify(data)
            //.append("<li>" + JSON.stringify(data) + "<li>")
            
            alert(data);
            //document.getELementById('temp')textContent = data;
            $('temp').innerHTML = data;
            

        }//,
         //complete: function() {
       // Schedule the next request when the current one's complete
        // The interval set to 5 seconds
     });
    
}

</script>
-->
</form>
<script type="text/javascript">
    alerted = false;
</script>

<script type="text/javascript">
    var time = new Date().getHours();
    var greeting = 'Good '+ (time < 12 ? 'Morning' : 
        time < 18 ? 'Afternoon' : 'Evening');
    var coffeeFacts = ["Caffeine blocks an inhibitory neurotransmitter in your brain, which causes a stimulant effect. This improves energy levels, mood and various aspects of brain function.",
                '"Several studies show that caffeine can increase fat burning and boost your metabolic rate."',
                '"Caffeine can increase adrenaline levels and release fatty acids from your fat tissues."',
                '"Coffee can lead to significant improvements in physical performance."',
                '"Coffee contains several important nutrients, including riboflavin, pantothenic acid, manganese, potassium, magnesium and niacin."',
                '"Several observational studies show that coffee drinkers have a much lower risk of type 2 diabetes, a serious condition that affects millions of people worldwide."',
                '"Coffee drinkers have a much lower risk of getting Alzheimer’s disease, which is a leading cause of dementia worldwide."',
                '"Coffee drinkers have up to a 60% lower risk of getting Parkinson’s disease"',
                '"Coffee appears to lower your risk of developing depression"',
                '"Coffee lowers the risk of getting liver and colorectal cancer"',
                '"Coffee drinkers do not have an increased risk of heart disease and have a slightly lower risk of stroke."',
                '"Coffee is rich in powerful antioxidants"',
                '"Drinking coffee in moderation may protect against heart failure"']

    var funFact = coffeeFacts[Math.floor(Math.random() * coffeeFacts.length)];            
    document.getElementById("time").innerHTML = greeting;
    /*
    var i = 0;
    function setInterval() {
        document.getElementById("fact").innerHTML = coffeeFacts[i];
        if (i == (coffeeFacts.length - 1)) {
        i = 0;
        //you can even clear interval here to make heading stay as last one in array
        //cleanInterval(intervalId);

        } else {
            i++;
        }
    }, 4000)
    */
    document.getElementById("fact").innerHTML = funFact;
    var user = '{{user.first_name}}'
    var url = 'http://184.148.145.47:5000/users/' + user;

    async function setColours(){
        var LED_Response = await fetch(url);
        
        var LED_data = await LED_Response.json();
        LED_data = LED_data.data;
        console.log(LED_data);

        $("#C_RGB").val(LED_data.C_RGB == null ? "#0000FF" : LED_data.C_RGB);
        $("#C_RGB").trigger('change');

        $("#P_RGB").val(LED_data.P_RGB == null ? "#00FF00" : LED_data.P_RGB);
        $("#P_RGB").trigger('change');

        $("#H_RGB").val(LED_data.H_RGB == null ? "#FF0000" : LED_data.H_RGB);
        $("#H_RGB").trigger('change');
    }

    async function getTemp() {
        console.log(alerted)
        const header = {
            headers: {
            'Access-Control-Allow-Origin': '*',
            'Content-Type': 'multipart/form-data'
            //mode: 'no-cors'
        }
        };
        var user = '{{user.first_name}}'
        console.log(user)
        const response = await fetch('http://184.148.145.47:5000/users/'+ user);
        
        //alert("YEs")
        const data = await response.json();
        //if (response.status !== 200) {
            //  throw Error(data.message);
        //}
        //else{

        console.log(data);
        //const mon = data.user
        document.getElementById('temp').innerHTML = data.data.temperature + " °C";
        document.getElementById('vol').innerHTML = data.data.volume + " ml";

        //alert("YES!");
        if (data.data.temperature === data.data.des_temp){
            //if (data.data.temperature === data.data.des_temp) {
            console.log("rgb"+data.data.P_RGB)
            document.getElementById('dot').style.color = "rgb"+data.data.P_RGB ;
            if (alerted === false){
                alert("Coffee Has Reached Desired Temperature. Enjoy Your Perfect Sip!");
                alerted = true;
            }

        }

        if (data.data.temperature > data.data.des_temp) {
            document.getElementById('dot').style.color = "rgb"+data.data.H_RGB ;
        }

            if (data.data.temperature < data.data.des_temp) {
            document.getElementById('dot').style.color = "rgb"+data.data.C_RGB ;
            console.log(data.data.C_RGB)
        }

        
        // }

        //alert(data);
    }

    setColours();
    getTemp();
    //document.getTemp();
    setInterval(getTemp, 5000);
</script>
<body>

</body>
<br />



{% endblock %}